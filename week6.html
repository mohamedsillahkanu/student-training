<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICF-SL AI Assistant</title>  
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(30,64,175,0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .icf-image {
            text-align: center;
            margin-bottom: 20px;
        }

        .icf-image img {
            max-width: 300px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* URL Opener Section */
        .url-opener {
            background: #334155;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #10b981;
        }

        .url-opener h3 {
            color: #10b981;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .url-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .url-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 14px;
        }

        .url-input button {
            padding: 12px 20px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        .url-input button:hover {
            background: #059669;
        }

        .url-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .url-controls button {
            padding: 8px 16px;
            background: #475569;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .url-controls button:hover {
            background: #3b82f6;
        }

        .url-display {
            width: 100%;
            height: 600px;
            border: 2px solid #475569;
            border-radius: 8px;
            background: #1e293b;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .browser-header {
            background: #475569;
            padding: 10px;
            border-bottom: 1px solid #64748b;
        }

        .browser-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .browser-controls button {
            padding: 6px 12px;
            background: #1e293b;
            color: #e2e8f0;
            border: 1px solid #64748b;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .browser-controls button:hover {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .current-url {
            flex: 1;
            background: #1e293b;
            color: #94a3b8;
            padding: 6px 12px;
            border: 1px solid #64748b;
            border-radius: 4px;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .url-display iframe {
            width: 100%;
            height: calc(100% - 50px);
            border: none;
            background: white;
        }

        .api-setup {
            background: #334155;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #f59e0b;
        }

        .api-setup h3 {
            color: #f59e0b;
            margin-bottom: 15px;
        }

        .api-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .api-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 14px;
        }

        .api-input button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .api-input button:hover {
            background: #2563eb;
        }

        .chat-container {
            flex: 1;
            background: #334155;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            min-height: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .chat-header {
            background: #475569;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #64748b;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 10px;
            max-width: 80%;
        }

        .message.user {
            background: #3b82f6;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message.assistant {
            background: #1e293b;
            color: #e2e8f0;
            border: 1px solid #475569;
            border-bottom-left-radius: 4px;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #475569;
            background: #475569;
            border-radius: 0 0 10px 10px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #64748b;
            border-radius: 8px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 16px;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .send-btn {
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .send-btn:hover:not(:disabled) {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .send-btn:disabled {
            background: #64748b;
            cursor: not-allowed;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #94a3b8;
            font-style: italic;
        }

        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #475569;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #dc2626;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .success {
            background: #059669;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .suggestions {
            background: #1e293b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #475569;
        }

        .suggestions h4 {
            color: #60a5fa;
            margin-bottom: 10px;
        }

        .suggestion-btn {
            display: inline-block;
            background: #475569;
            color: #e2e8f0;
            padding: 8px 12px;
            margin: 5px 5px 5px 0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .suggestion-btn:hover {
            background: #3b82f6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .message {
                max-width: 95%;
            }

            .url-input {
                flex-direction: column;
            }

            .url-controls {
                flex-wrap: wrap;
            }
        }

        .quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .quick-link-btn {
            padding: 6px 12px;
            background: #1e293b;
            color: #10b981;
            border: 1px solid #10b981;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .quick-link-btn:hover {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 ICF Sierra Leone AI Assistant</h1>
            <p>Your intelligent companion for public health insights and data analysis</p>
        </div>

        <div class="icf-image">
            <img src="https://raw.githubusercontent.com/mohamedsillahkanu/si/726bcf69bf5539d005011a0bfd7ebc91a4b29a06/icf_sl%20(1).jpg" 
                 alt="ICF Sierra Leone" 
                 onerror="this.style.display='none'">
        </div>

        <!-- EMBEDDED URL BROWSER -->
        <div class="url-opener">
            <h3>🌐 Embedded Web Browser</h3>
            
            <div class="url-input">
                <input type="url" id="urlInput" placeholder="Enter URL (e.g., https://www.google.com)" value="https://www.google.com">
                <button onclick="embedURL()">🔗 Embed & Open</button>
                <button onclick="toggleBrowser()" id="toggleBtn">📱 Show Browser</button>
            </div>

            <div class="quick-links">
                <button class="quick-link-btn" onclick="embedQuickURL('https://www.google.com')">Google</button>
                <button class="quick-link-btn" onclick="embedQuickURL('https://www.who.int')">WHO</button>
                <button class="quick-link-btn" onclick="embedQuickURL('https://scholar.google.com')">Scholar</button>
                <button class="quick-link-btn" onclick="embedQuickURL('https://www.dhsprogram.com')">DHS Program</button>
            </div>
        </div>

        <!-- EMBEDDED BROWSER DISPLAY -->
        <div class="url-display" id="urlDisplay" style="display: none;">
            <div class="browser-header">
                <div class="browser-controls">
                    <button onclick="goBack()">⬅️</button>
                    <button onclick="goForward()">➡️</button>
                    <button onclick="refreshURL()">🔄</button>
                    <span class="current-url" id="currentUrl">about:blank</span>
                    <button onclick="closeBrowser()">❌</button>
                </div>
            </div>
            <iframe id="urlFrame" src="about:blank"></iframe>
        </div>

        <div class="suggestions">
            <h4>💡 Try asking:</h4>
            <button class="suggestion-btn" onclick="sendSuggestion('How do I calculate malaria incidence rates?')">Calculate incidence rates</button>
            <button class="suggestion-btn" onclick="sendSuggestion('What are best practices for survey design?')">Survey design tips</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Help me analyze demographic data')">Analyze demographics</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Explain sampling methodology')">Sampling methods</button>
            <button class="suggestion-btn" onclick="sendSuggestion('How to clean and prepare data in R?')">Data cleaning in R</button>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <h3>💬 Chat with ICF-SL Assistant</h3>
                <button onclick="clearChat()" style="float: right; background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Clear Chat</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message assistant">
                    <strong>ICF-SL Assistant:</strong> Hello! I'm here to help you with questions about public health, data analysis, research methodology, and ICF Sierra Leone programs. You can also embed websites directly in the platform using the browser above. How can I assist you today?
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Ask me anything about ICF-SL programs, data analysis, or public health..." onkeypress="handleKeyPress(event)">
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ADD YOUR OPENAI API KEY HERE:
        const apiKey = 'YOUR_API_KEY_HERE';
        
        let isProcessing = false;
        let urlHistory = [];
        let currentUrlIndex = -1;

        // EMBEDDED URL BROWSER FUNCTIONS
        function embedURL() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a URL to embed');
                return;
            }
            
            // Add https:// if not present
            let formattedUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                formattedUrl = 'https://' + url;
            }
            
            embedURLInFrame(formattedUrl);
        }

        function embedQuickURL(url) {
            document.getElementById('urlInput').value = url;
            embedURLInFrame(url);
        }

        function embedURLInFrame(url) {
            const urlFrame = document.getElementById('urlFrame');
            const urlDisplay = document.getElementById('urlDisplay');
            const currentUrlSpan = document.getElementById('currentUrl');
            const toggleBtn = document.getElementById('toggleBtn');
            
            // Show the embedded browser
            urlDisplay.style.display = 'block';
            toggleBtn.textContent = '📱 Hide Browser';
            toggleBtn.onclick = toggleBrowser;
            
            // Add to history
            if (currentUrlIndex === -1 || urlHistory[currentUrlIndex] !== url) {
                urlHistory = urlHistory.slice(0, currentUrlIndex + 1);
                urlHistory.push(url);
                currentUrlIndex = urlHistory.length - 1;
            }
            
            // Load the URL in embedded frame
            urlFrame.src = url;
            currentUrlSpan.textContent = url;
            
            // Update input field
            document.getElementById('urlInput').value = url;
            
            showSuccess(`Embedded: ${url}`);
            
            // Add message to chat
            addMessage('assistant', `🌐 <strong>Website Embedded:</strong> ${url}<br>The website is now embedded above. You can continue chatting while browsing!`);
        }

        function toggleBrowser() {
            const urlDisplay = document.getElementById('urlDisplay');
            const toggleBtn = document.getElementById('toggleBtn');
            
            if (urlDisplay.style.display === 'none') {
                urlDisplay.style.display = 'block';
                toggleBtn.textContent = '📱 Hide Browser';
            } else {
                urlDisplay.style.display = 'none';
                toggleBtn.textContent = '📱 Show Browser';
            }
        }

        function closeBrowser() {
            const urlDisplay = document.getElementById('urlDisplay');
            const urlFrame = document.getElementById('urlFrame');
            const toggleBtn = document.getElementById('toggleBtn');
            const currentUrlSpan = document.getElementById('currentUrl');
            
            urlDisplay.style.display = 'none';
            urlFrame.src = 'about:blank';
            currentUrlSpan.textContent = 'about:blank';
            toggleBtn.textContent = '📱 Show Browser';
            document.getElementById('urlInput').value = '';
            
            addMessage('assistant', '🌐 <strong>Browser closed.</strong> Feel free to embed another website or continue our conversation!');
        }

        function goBack() {
            if (currentUrlIndex > 0) {
                currentUrlIndex--;
                const url = urlHistory[currentUrlIndex];
                document.getElementById('urlFrame').src = url;
                document.getElementById('urlInput').value = url;
                document.getElementById('currentUrl').textContent = url;
                showSuccess('Navigated back');
            }
        }

        function goForward() {
            if (currentUrlIndex < urlHistory.length - 1) {
                currentUrlIndex++;
                const url = urlHistory[currentUrlIndex];
                document.getElementById('urlFrame').src = url;
                document.getElementById('urlInput').value = url;
                document.getElementById('currentUrl').textContent = url;
                showSuccess('Navigated forward');
            }
        }

        function refreshURL() {
            const urlFrame = document.getElementById('urlFrame');
            const currentSrc = urlFrame.src;
            if (currentSrc && currentSrc !== 'about:blank') {
                urlFrame.src = currentSrc;
                showSuccess('Page refreshed');
            }
        }

        function goHome() {
            embedQuickURL('https://www.google.com');
        }

        function closeURL() {
            closeBrowser();
        }

        // Allow Enter key to embed URL
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                embedURL();
            }
        });

        // EXISTING CHAT FUNCTIONS
        function sendSuggestion(text) {
            document.getElementById('messageInput').value = text;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !isProcessing) {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;

            // Check if API key is set
            if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
                showError('Please add your OpenAI API key to the code first!');
                return;
            }

            // Add user message to chat
            addMessage('user', message);
            input.value = '';
            
            // Show loading state
            isProcessing = true;
            document.getElementById('sendBtn').disabled = true;
            const loadingDiv = addMessage('assistant', '<div class="loading">Thinking</div>');

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an AI assistant for ICF Sierra Leone. You help with questions about public health, development programs, data analysis, research methodology, and survey design. Be helpful, professional, and informative. Focus on practical guidance for health researchers and program implementers in Sierra Leone context.'
                            },
                            ...getChatHistory(),
                            { role: 'user', content: message }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                const assistantMessage = data.choices[0].message.content;

                // Remove loading message and add actual response
                loadingDiv.remove();
                addMessage('assistant', assistantMessage);

            } catch (error) {
                loadingDiv.remove();
                addMessage('assistant', `Error: ${error.message}. Please check your API key and internet connection.`);
            } finally {
                isProcessing = false;
                document.getElementById('sendBtn').disabled = false;
            }
        }

        function addMessage(role, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            if (role === 'user') {
                messageDiv.innerHTML = `<strong>You:</strong> ${content}`;
            } else {
                messageDiv.innerHTML = `<strong>ICF-SL Assistant:</strong> ${content}`;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return messageDiv;
        }

        function getChatHistory() {
            const messages = document.querySelectorAll('.message');
            const history = [];
            
            messages.forEach(msg => {
                if (msg.classList.contains('user')) {
                    const content = msg.textContent.replace('You: ', '');
                    history.push({ role: 'user', content: content });
                } else if (msg.classList.contains('assistant') && !msg.querySelector('.loading')) {
                    const content = msg.textContent.replace('ICF-SL Assistant: ', '');
                    history.push({ role: 'assistant', content: content });
                }
            });
            
            return history;
        }

        function clearChat() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="message assistant">
                    <strong>ICF-SL Assistant:</strong> Hello! I'm here to help you with questions about public health, data analysis, research methodology, and ICF Sierra Leone programs. You can also embed websites directly in the platform using the browser above. How can I assist you today?
                </div>
            `;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if API key has been set
            if (apiKey === 'YOUR_API_KEY_HERE' || !apiKey) {
                showError('Please add your OpenAI API key to the code first!');
                return;
            }
            
            console.log('ICF-SL Chatbot with URL opener initialized successfully');
        });

        // Add some ICF-SL specific functionality
        function showAboutICF() {
            addMessage('assistant', `
                <strong>About ICF Sierra Leone:</strong><br><br>
                ICF is a global consulting and digital services company that partners with Sierra Leone on various development initiatives including:<br>
                • Public health program evaluation<br>
                • Demographic and health surveys<br>
                • Malaria prevention and control programs<br>
                • Health system strengthening<br>
                • Data collection and analysis<br>
                • Research methodology and capacity building<br><br>
                How can I help you with your specific project or research question?
            `);
        }

        // Add helpful shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + Enter to send message
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
